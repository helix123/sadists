```{r setup,include=FALSE}
# set the knitr options ... for everyone!
# if you unset this, then vignette build bonks. oh, joy.
#opts_knit$set(progress=TRUE)
opts_knit$set(eval.after='fig.cap')
# for a package vignette, you do want to echo.
# opts_chunk$set(echo=FALSE,warning=FALSE,message=FALSE)
opts_chunk$set(warning=FALSE,message=FALSE)
#opts_chunk$set(results="asis")
opts_chunk$set(cache=TRUE,cache.path="cache/")

#opts_chunk$set(fig.path="github_extra/figure/",dev=c("pdf","cairo_ps"))
#opts_chunk$set(fig.path="github_extra/figure/",dev=c("png","pdf"))
opts_chunk$set(fig.path="github_extra/figure/",dev=c("png"))
#opts_chunk$set(fig.width=5,fig.height=4,dpi=64)
opts_chunk$set(fig.width=7,fig.height=11,dpi=150,out.width='700px',out.height='1100px')

opts_chunk$set(eval=TRUE,echo=TRUE)

# doing this means that png files are made of figures;
# the savings is small, and it looks like shit:
#opts_chunk$set(fig.path="figure/",dev=c("png","pdf","cairo_ps"))
#opts_chunk$set(fig.width=4,fig.height=4)
# for figures? this is sweave-specific?
#opts_knit$set(eps=TRUE)

# this would be for figures:
#opts_chunk$set(out.width='.8\\textwidth')
# for text wrapping:
options(width=64,digits=2)
opts_chunk$set(size="small")
opts_chunk$set(tidy=TRUE,tidy.opts=list(width.cutoff=50,keep.blank.line=TRUE))

#sadists.meta <- packageDescription('sadists')
require(sadists)
```

# sadists

[![Build Status](https://travis-ci.org/shabbychef/sadists.png)](https://travis-ci.org/shabbychef/sadists)

Some Additional Distributions apparently not available in R.

-- Steven E. Pav, shabbychef@gmail.com

## Installation

This package may be installed from CRAN; the latest version may be
found on [github](https://www.github.com/shabbychef/sadists "sadists")
via devtools, or installed via [drat](https://github.com/eddelbuettel/drat "drat"):

```{r install,eval=FALSE,echo=TRUE}
if (require(devtools)) {
	# latest greatest
	install_github('shabbychef/sadists')
}
# via drat:
if (require(drat)) {
	drat:::add('shabbychef')
	install.packages('sadists')
}
```

## Testing distributions

First some functions to test the 'dpqr' functions:

```{r dpqr}
require(ggplot2)
# from: http://www.cookbook-r.com/Graphs/Multiple_graphs_on_one_page_(ggplot2)/
# Multiple plot function
#
# ggplot objects can be passed in ..., or to plotlist (as a list of ggplot objects)
# - cols:   Number of columns in layout
# - layout: A matrix specifying the layout. If present, 'cols' is ignored.
#
# If the layout is something like matrix(c(1,2,3,3), nrow=2, byrow=TRUE),
# then plot 1 will go in the upper left, 2 will go in the upper right, and
# 3 will go all the way across the bottom.
#
multiplot <- function(..., plotlist=NULL, file, cols=1, layout=NULL) {
  require(grid)

  # Make a list from the ... arguments and plotlist
  plots <- c(list(...), plotlist)

  numPlots = length(plots)

  # If layout is NULL, then use 'cols' to determine layout
  if (is.null(layout)) {
    # Make the panel
    # ncol: Number of columns of plots
    # nrow: Number of rows needed, calculated from # of cols
    layout <- matrix(seq(1, cols * ceiling(numPlots/cols)),
                    ncol = cols, nrow = ceiling(numPlots/cols))
  }

 if (numPlots==1) {
    print(plots[[1]])

  } else {
    # Set up the page
    grid.newpage()
    pushViewport(viewport(layout = grid.layout(nrow(layout), ncol(layout))))

    # Make each plot, in the correct location
    for (i in 1:numPlots) {
      # Get the i,j matrix positions of the regions that contain this subplot
      matchidx <- as.data.frame(which(layout == i, arr.ind = TRUE))

      print(plots[[i]], vp = viewport(layout.pos.row = matchidx$row,
                                      layout.pos.col = matchidx$col))
    }
  }
}
testf <- function(dpqr,nobs,...) {
	rv <- dpqr$r(nobs,...)
	data <- data.frame(draws=rv,pvals=dpqr$p(rv,...))

	# http://stackoverflow.com/a/5688125/164611
	p1 <- qplot(rv, geom = 'blank') +   
		geom_line(aes(y = ..density.., colour = 'Empirical'), stat = 'density') +  
		stat_function(fun = function(x) { dpqr$d(x,...) }, aes(colour = 'Theoretical')) +                       
		geom_histogram(aes(y = ..density..), alpha = 0.3) +                        
		scale_colour_manual(name = 'Density', values = c('red', 'blue')) +
		labs(title="Density (tests dfunc)")

	# Q-Q plot
	p2 <- ggplot(data, aes(sample = draws)) + stat_qq(dist=function(p) { dpqr$q(p,...) }) +
		labs(title="Q-Q plot (tests qfunc)")

	# empirical CDF of the p-values; should be uniform
	p3 <- ggplot(data, aes(sample = pvals)) + stat_qq(dist=qunif) + 
		labs(title="P-P plot (tests pfunc)")

	multiplot(p1,p2,p3,cols=1)
}
```

## Sum of (non-central) Chi-squares

The weighted sum of chi-squares is not a commonly seen random variable. However, its cumulants can be
easily computed, so these can be used to compute the 'PDQ' functions. Moreover, its distribution and quantile
functions can be used in computation of those of the doubly non-central F.

```{r sumchisq}
require(sadists)
wts <- c(1,-3,4)
df <- c(100,20,10)
ncp <- c(5,3,1)
testf(list(d=dsumchisq,p=psumchisq,q=qsumchisq,r=rsumchisq),nobs=2^14,wts,df,ncp)
```

## Sum of (non-central) Chi 

The weighted sum of non-central chis is also not a commonly seen random variable. However, it is one normal shy of
an Upsilon distribution, which see. 

```{r sumchi}
require(sadists)
wts <- c(-3,2,5,-4,1)
df <- c(30,50,100,20,10)
ncp <- c(1,0,0,0,2)
testf(list(d=dsumchi,p=psumchi,q=qsumchi,r=rsumchi),nobs=2^14,wts,df,ncp)
```

## Sum of (non-central) Chisquare to power

A generalization of the previous two, this is the weighted sum of independent 
non-central chi-square variates taken to some powers.

```{r sumchipow}
require(sadists)
wts <- c(-1,1,3,-3)
df <- c(100,200,100,50)
ncp <- c(0,1,0.5,2)
pow <- c(1,0.5,2,1.5)
testf(list(d=dsumchipow,p=psumchipow,q=qsumchipow,r=rsumchipow),nobs=2^14,wts,df,ncp,pow)
```

## K-prime distribution

The K-prime distribution is the weighted sum of a standard normal and an independent central chi, 
all divided by another independent central chi. Depending on the degrees of freedom and the weights,
the K-prime can appears as a Lambda-prime, a normal, or a central t.

```{r kprime}
require(sadists)
v1 <- 20
v2 <- 40
a <- 0.3
b <- 1.5
testf(list(d=dkprime,p=pkprime,q=qkprime,r=rkprime),nobs=2^14,v1,v2,a,b)
```

## Lambda prime distribution

A [Lambda prime](http://arxiv.org/abs/1003.4890v1) random variable is the sum of a standard
normal and an independent, scaled central chi random variable.

```{r lambdap}
require(sadists)
df <- 50
ts <- 1.5
testf(list(d=dlambdap,p=plambdap,q=qlambdap,r=rlambdap),nobs=2^14,df,ts)
```

## Upsilon distribution

An upsilon random variable is the sum of a standard
normal and the weigted sum of several indpendent central chis.

```{r upsilon}
require(sadists)
df <- c(30,50,100,20,10)
ts <- c(-3,2,5,-4,1)
testf(list(d=dupsilon,p=pupsilon,q=qupsilon,r=rupsilon),nobs=2^14,df,ts)
```

## Nakagami distribution

The Nakagami distribution is merely a re-scaled central chi distribution.

```{r nakagami}
require(sadists)
m <- 120
Omega <- 4
testf(list(d=dnakagami,p=pnakagami,q=qnakagami,r=rnakagami),nobs=2^14,m,Omega)
```

## Doubly non-central t distribution

The [doubly non-central t distribution](https://en.wikipedia.org/wiki/Doubly_noncentral_t-distribution)
generalizes the t distribution to the case where the denominator chi-square is non-central.

```{r dnt}
require(sadists)
df <- 75
ncp1 <- 2
ncp2 <- 3
testf(list(d=ddnt,p=pdnt,q=qdnt,r=rdnt),nobs=2^14,df,ncp1,ncp2)
```

## Doubly non-central F distribution

The doubly non-central F distribution generalizes the F distribution to the case where the denominator
chi-square is non-central. 

```{r dnf}
require(sadists)
df1 <- 30
df2 <- 50
ncp1 <- 1.5
ncp2 <- 2.5
testf(list(d=ddnf,p=pdnf,q=qdnf,r=rdnf),nobs=2^14,df1,df2,ncp1,ncp2)
```
